syntax = "proto3";

package iotfsdb.v1.api;

import "google/protobuf/duration.proto";
import "iotfsdb/v1/common/reducer.proto";
import "iotfsdb/v1/common/partition_period.proto";
import "iotfsdb/v1/common/file.proto";
import "iotfsdb/v1/common/null_handler.proto";
import "iotfsdb/v1/common/series_criteria.proto";
import "iotfsdb/v1/common/series_data.proto";
import "iotfsdb/v1/common/size_control.proto";
import "iotfsdb/v1/common/status.proto";
import "iotfsdb/v1/common/time_range.proto";

option java_package = "org.huebert.iotfsdb.api.grpc.proto.v1.api";
option java_outer_classname = "DataServiceProto";
option java_multiple_files = true;

// DataService provides operations for reading, writing and exporting time-series data
service DataService {

  // ExportData exports time-series data matching criteria to a file
  rpc ExportData(ExportDataRequest) returns (ExportDataResponse);

  // FindData retrieves time-series data matching criteria within a time range
  rpc FindData(FindDataRequest) returns (FindDataResponse);

  // ImportData imports time-series data from a file
  rpc ImportData(ImportDataRequest) returns (ImportDataResponse);

  // InsertData inserts streaming time-series data points
  rpc InsertData(stream InsertDataRequest) returns (stream InsertDataResponse);
}

message ExportDataRequest {
  iotfsdb.v1.common.SeriesCriteria criteria = 1;
}

message FindDataRequest {
  iotfsdb.v1.common.SeriesCriteria criteria = 1;
  iotfsdb.v1.common.TimeRange time_range = 2;
  iotfsdb.v1.common.SizeControl size_control = 3;
  iotfsdb.v1.common.NullHandler null_handler = 4;
  bool high_precision = 5;
  iotfsdb.v1.common.Reducer time_reducer = 6;
  iotfsdb.v1.common.Reducer series_reducer = 7;
  iotfsdb.v1.common.PartitionPeriod partition = 8;
}

message ImportDataRequest {
  iotfsdb.v1.common.File file = 1;
}

message InsertDataRequest {
  iotfsdb.v1.common.SeriesData data = 1;
  iotfsdb.v1.common.Reducer reducer = 2;
}

message FindDataResponse {
  iotfsdb.v1.common.Status status = 1;
  repeated iotfsdb.v1.common.SeriesData data = 2;
}

message ImportDataResponse {
  iotfsdb.v1.common.Status status = 1;
}

message InsertDataResponse {
  iotfsdb.v1.common.Status status = 1;
}

message ExportDataResponse {
  iotfsdb.v1.common.Status status = 1;
  iotfsdb.v1.common.File file = 2;
}
