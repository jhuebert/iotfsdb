syntax = "proto3";

package iotfsdb;

import "google/protobuf/wrappers.proto";
import "iotfsdb-enums.proto";
import "iotfsdb-types.proto";

option java_package = "org.huebert.iotfsdb.api.proto";

service SeriesService {
  rpc CloneSeries(CloneSeriesRequest) returns (CloneSeriesResponse);
  rpc CreateSeries(CreateSeriesRequest) returns (CreateSeriesResponse);
  rpc DeleteSeries(DeleteSeriesRequest) returns (DeleteSeriesResponse);
  rpc FindSeries(FindSeriesRequest) returns (FindSeriesResponse);
  rpc PruneSeries(PruneSeriesRequest) returns (PruneSeriesResponse);
  rpc UpdateDefinition(UpdateDefinitionRequest) returns (UpdateDefinitionResponse);
  rpc UpdateMetadata(UpdateMetadataRequest) returns (UpdateMetadataResponse);
}

service DataService {
  rpc ExportData(ExportDataRequest) returns (ExportDataResponse);
  rpc FindData(FindDataRequest) returns (FindDataResponse);
  rpc ImportData(ImportDataRequest) returns (ImportDataResponse);
  rpc InsertData(stream InsertDataRequest) returns (stream InsertDataResponse);
}

message CloneSeriesRequest {
  string source_id = 1;
  string destination_id = 2;
  bool include_data = 3;
}

message CreateSeriesRequest {
  Series series = 1;
}

message DeleteSeriesRequest {
  string id = 1;
}

message ExportDataRequest {
  SeriesCriteria criteria = 1;
}

message FindDataRequest {
  SeriesCriteria criteria = 1;
  TimeRange time_range = 2;
  oneof size_option {
    google.protobuf.Int64Value interval_ms = 3;
    google.protobuf.Int32Value size = 4;
  }
  oneof null_option {
    NullHandler null_handler = 5;
    google.protobuf.DoubleValue null_value = 6;
  }
  bool high_precision = 7;
  Reducer time_reducer = 8;
  Reducer series_reducer = 9;
}

message FindSeriesRequest {
  SeriesCriteria criteria = 1;
}

message ImportDataRequest {
  File file = 1;
}

message InsertDataRequest {
  SeriesData data = 1;
  Reducer reducer = 2;
}

message PruneSeriesRequest {
  string id = 1;
  TimeRange time_range = 2;
}

message UpdateDefinitionRequest {
  string id = 1;
  SeriesDefinition definition = 2;
}

message UpdateMetadataRequest {
  string id = 1;
  map<string, string> metadata = 2;
  bool merge = 3;
}

message CloneSeriesResponse {
  Status status = 1;
}

message CreateSeriesResponse {
  Status status = 1;
}

message DeleteSeriesResponse {
  Status status = 1;
}

message FindDataResponse {
  Status status = 1;
  repeated SeriesData data = 2;
}

message FindSeriesResponse {
  Status status = 1;
  repeated Series series = 2;
}

message ImportDataResponse {
  Status status = 1;
}

message InsertDataResponse {
  Status status = 1;
}

message PruneSeriesResponse {
  Status status = 1;
}

message UpdateDefinitionResponse {
  Status status = 1;
}

message UpdateMetadataResponse {
  Status status = 1;
}

message ExportDataResponse {
  Status status = 1;
  File file = 2;
}
